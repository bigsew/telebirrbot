<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Digital Pro ¬∑ SQLite Database</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sql.js@1.8.0/dist/sql-wasm.js"></script>
    
    <style>
        :root {
            --tg-theme-bg-color: #f0f2f5;
            --primary-blue: #0088cc;
            --star-gold: #FFD700;
            --premium-purple: #8B5CF6;
            --glass: rgba(255, 255, 255, 0.9);
            --admin-badge: #dc3545;
            --verified-green: #00C851;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color);
            margin: 0;
            padding-bottom: 90px;
            color: #1c1c1e;
        }

        .app-shell {
            max-width: 480px;
            margin: 0 auto;
            background: #fdfdfd;
            min-height: 100vh;
            position: relative;
        }

        .glass-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 15px;
        }

        .hero-card {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1614850523296-d8c1af93d400?w=600');
            background-size: cover;
            background-position: center;
            border-radius: 24px;
            padding: 30px 20px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }

        .search-box {
            background: #f1f1f1;
            border: none;
            border-radius: 12px;
            padding: 10px 15px;
            width: 100%;
            margin-bottom: 15px;
            color: #1c1c1e;
        }

        .filter-scroll {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 5px;
            scrollbar-width: none;
        }
        .filter-scroll::-webkit-scrollbar { display: none; }

        .chip {
            padding: 6px 16px;
            border-radius: 20px;
            background: #fff;
            border: 1px solid #ddd;
            font-size: 0.85rem;
            white-space: nowrap;
            cursor: pointer;
            color: #1c1c1e;
        }
        .chip.active {
            background: var(--primary-blue);
            color: #fff;
            border-color: var(--primary-blue);
        }

        .card-job {
            background: #fff;
            border-radius: 20px;
            border: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .card-img {
            height: 160px;
            width: 100%;
            object-fit: cover;
        }

        .job-content {
            padding: 18px;
        }

        .job-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #1c1c1e;
        }

        .app-badge {
            display: inline-block;
            background: var(--primary-blue);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
        }

        .admin-badge {
            background: var(--admin-badge);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            margin-left: 8px;
        }

        .amharic-description {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-blue);
        }

        .amharic-text {
            font-size: 0.95rem;
            color: #1c1c1e;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .feature-list li {
            padding: 6px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px dashed #e0e0e0;
            color: #1c1c1e;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list i {
            color: #28a745;
            font-size: 1rem;
            width: 20px;
        }

        .feature-emoji {
            font-size: 1.1rem;
            margin-right: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-app {
            flex: 1;
            padding: 12px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.85rem;
            border: none;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-app.details {
            background: #28a745;
            color: white;
        }

        .btn-app.download {
            background: var(--primary-blue);
            color: white;
        }

        .btn-app.tutorial {
            background: #dc3545;
            color: white;
        }

        .btn-app.admin-edit {
            background: #6f42c1;
            color: white;
        }

        .btn-app:hover {
            opacity: 0.9;
            transform: scale(0.98);
        }

        .profile-header-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 30px;
            padding: 25px 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.03);
            margin-bottom: 20px;
        }

        .profile-header-card h4 {
            color: #1c1c1e !important;
        }

        .profile-header-card p {
            color: #666 !important;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stat-item {
            background: white;
            border-radius: 20px;
            padding: 15px 5px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02);
            border: 1px solid #eee;
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: 800;
            color: #0088cc !important;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #666 !important;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-collection {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }

        .achievement-badge {
            background: #e9f2ff;
            color: #0066a1 !important;
            padding: 6px 16px;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .achievement-badge i {
            color: #0088cc !important;
        }

        .verified-badge {
            background: #e8f5e9;
            color: #00a65a !important;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            border: 1px solid rgba(0,200,80,0.3);
        }

        .premium-user-badge {
            background: #f1e5ff;
            color: #8B5CF6 !important;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .profile-header-card h6 {
            color: #1c1c1e !important;
            font-weight: 700;
        }

        .profile-header-card .border-bottom {
            color: #444 !important;
            font-size: 0.9rem;
            padding: 8px 0;
        }

        .admin-panel {
            background: #1a1e2b;
            color: white;
            border-radius: 28px;
            padding: 20px;
            margin: 20px 0;
        }

        .admin-tool {
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #ffc107;
            color: white;
        }

        .admin-tool span {
            color: white !important;
        }

        .user-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: white;
        }

        .user-row:last-child {
            border-bottom: none;
        }

        .user-tag {
            background: #2d3345;
            padding: 4px 10px;
            border-radius: 30px;
            font-size: 0.8rem;
            color: #ddd !important;
        }

        .add-job-form {
            background: #2d3345;
            border-radius: 20px;
            padding: 15px;
            margin-top: 15px;
        }
        .add-job-form input, .add-job-form select, .add-job-form textarea {
            background: #3f465a;
            border: none;
            color: white;
            border-radius: 12px;
            padding: 10px 15px;
            width: 100%;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        .add-job-form input::placeholder, .add-job-form textarea::placeholder {
            color: #a0a6b8;
        }
        .add-job-form label {
            font-size: 0.8rem;
            color: #b0b7d0 !important;
            margin-bottom: 4px;
            display: block;
        }

        .service-card {
            background: #fff;
            border-radius: 18px;
            padding: 15px;
            border: 1px solid rgba(0,0,0,0.05);
            text-align: center;
            transition: 0.2s;
            height: 100%;
        }
        .service-card:active { transform: scale(0.95); background: #f8f9fa; }
        .service-card .small { color: #1c1c1e !important; }

        .premium-package-card {
            border-radius: 24px;
            padding: 24px 16px;
            color: white;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            width: 100%;
            border: none;
            box-shadow: 0 20px 30px -10px rgba(0,0,0,0.3);
            margin-bottom: 16px;
        }
        
        .card-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-2 { background: linear-gradient(135deg, #6B8CFF 0%, #8B5CF6 100%); }
        .card-3 { background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%); }
        .card-4 { background: linear-gradient(135deg, #00B4DB 0%, #0083B0 100%); }

        .premium-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            margin-bottom: 20px;
        }

        .premium-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(5px);
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .price-tag {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin: 15px 0;
            color: #FFD700;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .feature-list-premium {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            text-align: left;
        }

        .feature-list-premium li {
            padding: 6px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: white;
        }

        .feature-list-premium i {
            color: #FFD700;
        }

        .buy-btn {
            background: rgba(255,255,255,0.95);
            border: none;
            border-radius: 40px;
            padding: 14px;
            font-weight: 700;
            width: 100%;
            color: #333;
            transition: all 0.2s;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 1rem;
        }

        .buy-btn:hover {
            background: white;
            transform: scale(1.02);
        }

        .maintenance-box {
            background: linear-gradient(135deg, #2C3E50 0%, #4A5568 100%);
            border-radius: 24px;
            padding: 30px 20px;
            color: white;
            text-align: center;
            margin-bottom: 25px;
            border: 2px solid #FFD700;
            animation: glow 2s infinite;
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px #FFD700; }
            50% { box-shadow: 0 0 20px #FFD700; }
            100% { box-shadow: 0 0 5px #FFD700; }
        }

        .amharic-text-large {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 15px 0;
            color: #FFD700;
        }

        .notification-bell {
            animation: ring 2s infinite;
            display: inline-block;
        }
        
        @keyframes ring {
            0% { transform: rotate(0); }
            10% { transform: rotate(15deg); }
            20% { transform: rotate(-15deg); }
            30% { transform: rotate(15deg); }
            40% { transform: rotate(-15deg); }
            50% { transform: rotate(0); }
            100% { transform: rotate(0); }
        }

        .notified-btn {
            background: #FFD700;
            color: #000;
            border: none;
            border-radius: 40px;
            padding: 12px 30px;
            font-weight: 700;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .nav-dock {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 480px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
            border-top: 1px solid rgba(0,0,0,0.08);
            z-index: 2000;
        }

        .nav-btn {
            color: #8e8e93;
            text-decoration: none;
            font-size: 0.7rem;
            text-align: center;
            flex: 1;
            cursor: pointer;
        }
        .nav-btn.active { color: var(--primary-blue); }
        .nav-btn i { font-size: 1.4rem; display: block; }

        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card .fw-bold {
            color: #1c1c1e !important;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .db-status {
            font-size: 0.7rem;
            background: #e8f5e9;
            color: #2e7d32;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
    </style>
</head>
<body>

<div class="app-shell">
    
    <header class="glass-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5 class="fw-bold mb-0">Digital Pro</h5>
                <div class="d-flex align-items-center gap-2 mt-1">
                    <span class="db-status" id="dbStatus">
                        <i class="bi bi-database"></i> Initializing...
                    </span>
                </div>
            </div>
            <div class="d-flex align-items-center gap-2">
                <i class="bi bi-bell-fill text-warning notification-bell"></i>
                <img src="https://ui-avatars.com/api/?name=User&background=0088cc&color=fff" id="user-avatar" class="rounded-circle" width="35" height="35">
            </div>
        </div>
    </header>

    <div class="p-3">
        <main id="main-content">
            
            <!-- HOME SECTION -->
            <section id="sec-home" class="fade-in">
                <div class="hero-card shadow">
                    <h2 class="fw-bold" id="welcomeName">Welcome Back!</h2>
                    <p class="small opacity-75">Start earning and growing your digital presence today.</p>
                    <button class="btn btn-light btn-sm rounded-pill px-4 fw-bold" onclick="navigateTo('sec-jobs')">View Daily Tasks</button>
                </div>

                <h6 class="fw-bold mb-3"><i class="bi bi-play-btn-fill text-danger"></i> Featured Tutorial</h6>
                <div class="ratio ratio-16x9 rounded-4 overflow-hidden shadow-sm mb-4">
                    <iframe src="https://www.youtube.com/embed/nQcpFX60puc" title="Gemgala Tutorial" allowfullscreen></iframe>
                </div>

                <h6 class="fw-bold mb-3">Our Social Community</h6>
                <div class="row g-3 mb-4">
                    <div class="col-4">
                        <a href="https://t.me/example" class="text-decoration-none">
                            <div class="service-card shadow-sm">
                                <i class="bi bi-telegram fs-2 text-primary"></i>
                                <div class="small mt-1">Join Group</div>
                            </div>
                        </a>
                    </div>
                    <div class="col-4">
                        <a href="https://youtube.com/example" class="text-decoration-none">
                            <div class="service-card shadow-sm">
                                <i class="bi bi-youtube fs-2 text-danger"></i>
                                <div class="small mt-1">Subscribe</div>
                            </div>
                        </a>
                    </div>
                    <div class="col-4">
                        <a href="https://tiktok.com/example" class="text-decoration-none">
                            <div class="service-card shadow-sm">
                                <i class="bi bi-tiktok fs-2 text-dark"></i>
                                <div class="small mt-1">Follow</div>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

            <!-- JOBS SECTION -->
            <section id="sec-jobs" class="fade-in d-none">
                <input type="text" class="search-box" placeholder="Search tasks..." id="jobSearch">
                
                <div class="filter-scroll mb-3">
                    <div class="chip active" onclick="filterType('all', this)">All</div>
                    <div class="chip" onclick="filterType('app', this)">üì≤ Apps <span id="app-count" class="ms-1">(0)</span></div>
                    <div class="chip" onclick="filterType('bot', this)">ü§ñ Bots <span id="bot-count" class="ms-1">(0)</span></div>
                    <div class="chip" onclick="filterType('web', this)">üåê Web <span id="web-count" class="ms-1">(0)</span></div>
                </div>

                <div id="job-container" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading jobs...</span>
                    </div>
                </div>
            </section>

            <!-- STARS SECTION -->
            <section id="sec-stars" class="fade-in d-none">
                <div class="text-center p-4 rounded-4 mb-4" style="background: #fff8e1; border: 2px dashed #ffd54f;">
                    <i class="bi bi-stars fs-1 text-warning"></i>
                    <h4 class="fw-bold mt-2">Telegram Stars</h4>
                    <p class="text-muted small">Fast & Secure Star Refills</p>
                </div>
                <div class="service-card p-4 shadow-sm mb-3">
                    <h5 class="fw-bold">Buy Stars / ·àµ·â≥·à≠ ·àà·àò·åç·ãõ·âµ</h5>
                    <p class="small text-muted">Get stars instantly for your favorite bots.</p>
                    <button class="btn btn-warning w-100 fw-bold py-3 rounded-4 shadow-sm" onclick="buyStars()">
                        <i class="bi bi-lightning-fill"></i> Purchase Now
                    </button>
                </div>
            </section>

            <!-- PREMIUM SECTION -->
            <section id="sec-premium" class="fade-in d-none">
                <div class="maintenance-box shadow-lg">
                    <div class="maintenance-icon">
                        <i class="bi bi-tools"></i>
                    </div>
                    <h3 class="fw-bold">üõ† Service Temporarily Unavailable</h3>
                    <h2 class="display-6 mb-3">üë®‚Äçüíª</h2>
                    
                    <div class="alert" style="background: rgba(255,215,0,0.2); border: 1px solid #FFD700; color: white;">
                        <i class="bi bi-exclamation-triangle-fill text-warning"></i>
                        <strong>‚ö†Ô∏è  ·ä†·åà·àç·åç·àé·â± ·åà·äì ·ä†·àç·â∞·åÄ·àò·à®·àù!</strong>
                    </div>
                    
                    <p class="amharic-text-large">·ä•·â£·ä≠·ãé ·âµ·äï·àΩ ·ã≠·å†·â•·âÅ ‚åõ</p>
                    
                    <div class="d-flex align-items-center justify-content-center gap-2 mt-3">
                        <i class="bi bi-check-circle-fill text-success"></i>
                        <span>‚úÖ·à≤·åÄ·àò·à≠ ·ãà·ã≤·ã´·ãç·äë ·ä•·äì·à≥·ãç·âÉ·àà·äï</span>
                        <i class="bi bi-bell-fill text-warning notification-bell"></i>
                    </div>
                    
                    <div class="mt-4">
                        <a href="https://t.me/Big_sew" target="_blank" class="notified-btn">
                            <i class="bi bi-telegram"></i> üîî Get Notified
                        </a>
                    </div>
                </div>

                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h5 class="fw-bold">
                        <i class="bi bi-telegram text-primary"></i> 
                        Telegram Premium
                    </h5>
                    <span class="badge bg-primary p-2">üá™üáπ Birr (ETB)</span>
                </div>

                <div class="premium-container">
                    <div class="premium-package-card card-1">
                        <div class="premium-badge">
                            <i class="bi bi-star-fill"></i> POPULAR
                        </div>
                        <i class="bi bi-calendar-check fs-1 mb-2"></i>
                        <h5 class="fw-bold">Monthly</h5>
                        <div class="price-tag">
                            $4.99 <small>/mo</small>
                        </div>
                        <div class="text-white-50 mb-2">·â•·à≠ 275.00 ETB</div>
                        <ul class="feature-list-premium">
                            <li><i class="bi bi-check-circle-fill"></i> 4GB File Uploads</li>
                            <li><i class="bi bi-check-circle-fill"></i> Faster Downloads</li>
                            <li><i class="bi bi-check-circle-fill"></i> Premium Badge</li>
                            <li><i class="bi bi-check-circle-fill"></i> Voice-to-Text</li>
                            <li><i class="bi bi-check-circle-fill"></i> Animated Avatars</li>
                        </ul>
                        <button class="buy-btn" onclick="buyPremium('monthly')">
                            <i class="bi bi-lock-fill"></i> Buy Now
                        </button>
                    </div>

                    <div class="premium-package-card card-2">
                        <div class="premium-badge">
                            <i class="bi bi-lightning-fill"></i> SAVE 10%
                        </div>
                        <i class="bi bi-calendar3 fs-1 mb-2"></i>
                        <h5 class="fw-bold">3 Months</h5>
                        <div class="price-tag">
                            $13.99 <small>/3mo</small>
                        </div>
                        <div class="text-white-50 mb-2">·â•·à≠ 770.00 ETB</div>
                        <ul class="feature-list-premium">
                            <li><i class="bi bi-check-circle-fill"></i> All Monthly Features</li>
                            <li><i class="bi bi-check-circle-fill"></i> Animated Profile</li>
                            <li><i class="bi bi-check-circle-fill"></i> Premium Stickers</li>
                            <li><i class="bi bi-check-circle-fill"></i> No Ads</li>
                            <li><i class="bi bi-check-circle-fill"></i> Chat Translation</li>
                        </ul>
                        <button class="buy-btn" onclick="buyPremium('quarterly')">
                            <i class="bi bi-lock-fill"></i> Buy Now
                        </button>
                    </div>

                    <div class="premium-package-card card-3">
                        <div class="premium-badge">
                            <i class="bi bi-gem"></i> SAVE 15%
                        </div>
                        <i class="bi bi-calendar2-week fs-1 mb-2"></i>
                        <h5 class="fw-bold">6 Months</h5>
                        <div class="price-tag">
                            $24.99 <small>/6mo</small>
                        </div>
                        <div class="text-white-50 mb-2">·â•·à≠ 1,375.00 ETB</div>
                        <ul class="feature-list-premium">
                            <li><i class="bi bi-check-circle-fill"></i> All 3M Features</li>
                            <li><i class="bi bi-check-circle-fill"></i> Message Translation</li>
                            <li><i class="bi bi-check-circle-fill"></i> Priority Support</li>
                            <li><i class="bi bi-check-circle-fill"></i> 4 Accounts</li>
                            <li><i class="bi bi-check-circle-fill"></i> Advanced File Management</li>
                        </ul>
                        <button class="buy-btn" onclick="buyPremium('halfyear')">
                            <i class="bi bi-lock-fill"></i> Buy Now
                        </button>
                    </div>

                    <div class="premium-package-card card-4">
                        <div class="premium-badge">
                            <i class="bi bi-crown"></i> BEST VALUE
                        </div>
                        <i class="bi bi-calendar-year fs-1 mb-2"></i>
                        <h5 class="fw-bold">1 Year</h5>
                        <div class="price-tag">
                            $39.99 <small>/yr</small>
                        </div>
                        <div class="text-white-50 mb-2">·â•·à≠ 2,200.00 ETB</div>
                        <ul class="feature-list-premium">
                            <li><i class="bi bi-check-circle-fill"></i> All 6M Features</li>
                            <li><i class="bi bi-check-circle-fill"></i> Channel Boosts</li>
                            <li><i class="bi bi-check-circle-fill"></i> Unlimited Reactions</li>
                            <li><i class="bi bi-check-circle-fill"></i> Early Access</li>
                            <li><i class="bi bi-check-circle-fill"></i> Priority Download Speed</li>
                        </ul>
                        <button class="buy-btn" onclick="buyPremium('yearly')">
                            <i class="bi bi-lock-fill"></i> Buy Now
                        </button>
                    </div>
                </div>
            </section>

            <!-- PROFILE+ SECTION -->
            <section id="sec-profile" class="fade-in d-none">
                <div id="profileContainer"></div>
            </section>

        </main>
    </div>

    <nav class="nav-dock">
        <a class="nav-btn active" onclick="nav('sec-home', this)"><i class="bi bi-house-door-fill"></i> Home</a>
        <a class="nav-btn" onclick="nav('sec-jobs', this)"><i class="bi bi-briefcase-fill"></i> Jobs</a>
        <a class="nav-btn" onclick="nav('sec-stars', this)"><i class="bi bi-star-fill"></i> Stars</a>
        <a class="nav-btn" onclick="nav('sec-premium', this)"><i class="bi bi-gem" style="color: #8B5CF6;"></i> Premium</a>
        <a class="nav-btn" onclick="nav('sec-profile', this)"><i class="bi bi-person-badge-fill"></i> Profile</a>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // ==================== SQLITE DATABASE ====================
    // This will automatically create database.db file in browser's storage
    let db = null;
    let SQL = null;

    // Database name
    const DB_NAME = 'digitalpro.db';

    // Initialize database
    async function initDatabase() {
        const statusEl = document.getElementById('dbStatus');
        
        try {
            statusEl.innerHTML = '<i class="bi bi-database"></i> Loading SQL.js...';
            
            // Initialize SQL.js
            SQL = await initSqlJs({
                locateFile: file => `https://cdn.jsdelivr.net/npm/sql.js@1.8.0/dist/${file}`
            });

            statusEl.innerHTML = '<i class="bi bi-database"></i> Creating database...';

            // Try to load existing database from localStorage
            let savedDb = localStorage.getItem(DB_NAME);
            
            if (savedDb) {
                // Load existing database
                const buffer = Uint8Array.from(atob(savedDb), c => c.charCodeAt(0));
                db = new SQL.Database(buffer);
                statusEl.innerHTML = '<i class="bi bi-database-check"></i> Database loaded';
                console.log('‚úÖ Database loaded from storage');
            } else {
                // Create new database
                db = new SQL.Database();
                await createTables();
                await insertSampleData();
                saveDatabase();
                statusEl.innerHTML = '<i class="bi bi-database-check"></i> New database created';
                console.log('‚úÖ New database created');
            }

            // Show database stats
            const stats = getDatabaseStats();
            statusEl.innerHTML = `<i class="bi bi-database"></i> ${stats.tables} tables, ${stats.records} records`;

        } catch (error) {
            console.error('Database error:', error);
            statusEl.innerHTML = '<i class="bi bi-database-exclamation"></i> Error';
        }
    }

    // Create tables
    async function createTables() {
        // Users table
        db.run(`
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                telegram_id TEXT UNIQUE NOT NULL,
                username TEXT,
                first_name TEXT,
                last_name TEXT,
                phone_verified INTEGER DEFAULT 0,
                is_admin INTEGER DEFAULT 0,
                balance REAL DEFAULT 0,
                tasks_completed INTEGER DEFAULT 0,
                referrals INTEGER DEFAULT 0,
                total_earned REAL DEFAULT 0,
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                last_active DATETIME DEFAULT CURRENT_TIMESTAMP
            )
        `);

        // Jobs table
        db.run(`
            CREATE TABLE IF NOT EXISTS jobs (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                title TEXT NOT NULL,
                type TEXT CHECK(type IN ('app', 'bot', 'web')),
                description TEXT,
                amharic_desc TEXT,
                download_link TEXT,
                tutorial_link TEXT,
                image_url TEXT,
                features TEXT, -- JSON string
                payment_verified INTEGER DEFAULT 0,
                min_withdraw REAL,
                referral_bonus REAL,
                is_active INTEGER DEFAULT 1,
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                created_by INTEGER,
                FOREIGN KEY (created_by) REFERENCES users(id)
            )
        `);

        // Activities table
        db.run(`
            CREATE TABLE IF NOT EXISTS activities (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER NOT NULL,
                activity_type TEXT CHECK(activity_type IN ('task_completed', 'referral_bonus', 'withdrawal', 'stars_purchased')),
                amount REAL,
                description TEXT,
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES users(id)
            )
        `);

        // Star purchases table
        db.run(`
            CREATE TABLE IF NOT EXISTS star_purchases (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER NOT NULL,
                amount INTEGER,
                price REAL,
                status TEXT DEFAULT 'pending' CHECK(status IN ('pending', 'completed', 'failed')),
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES users(id)
            )
        `);

        // Withdrawals table
        db.run(`
            CREATE TABLE IF NOT EXISTS withdrawals (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER NOT NULL,
                amount REAL,
                method TEXT CHECK(method IN ('paypal', 'bank', 'crypto')),
                account_details TEXT,
                status TEXT DEFAULT 'pending' CHECK(status IN ('pending', 'completed', 'rejected')),
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                processed_at DATETIME,
                FOREIGN KEY (user_id) REFERENCES users(id)
            )
        `);

        console.log('‚úÖ Tables created');
    }

    // Insert sample data
    async function insertSampleData() {
        // Check if jobs table is empty
        const result = db.exec("SELECT COUNT(*) as count FROM jobs");
        const count = result[0]?.values[0][0] || 0;

        if (count === 0) {
            const sampleJobs = [
                ['Gemgala üíé', 'app', 'Start earning with Gemgala app', 'üá™üáπ ·ä¢·âµ·ãÆ·åµ·ã´·ãç·ã´·äï ·â•·ãô·ãé·âΩ ·ä•·ãö·àÖ ·àã·ã≠ ·åà·äï·ãò·â• ·àõ·ãç·å£·âµ ·åÄ·àù·à®·ãã·àç üòÄ', 'https://getblock.me/u/24430158', 'https://youtu.be/nQcpFX60puc', 'https://images.unsplash.com/photo-1642790551116-18e150f248e3?w=500', '["100% Payment Verified","Minimum Withdraw 10$","1$ Per Referral"]', 1, 10, 1],
                ['Taka üéØ', 'app', 'Daily earning app', 'üö® ·ä†·àÅ·äë·äë ·àò·åÄ·àò·à≠ ·ã´·àà·â£·âΩ·àÅ ·àµ·à´ üíÅ', 'https://os8.me/WdfkCd', 'https://youtu.be/exampleTakaTutorial', 'https://images.unsplash.com/photo-1611162616305-c69b3fa7fbe0?w=500', '["Spin 7$-8$ ·ãï·ãµ·àç","5 ·ã∞·âÇ·âÉ mic on = 1 Spin daily","1 Invite = 2 Spin"]', 1, 7, 2],
                ['Hifami üéÆ', 'app', 'Game earning app', 'ü•á 0.3$ ·ä•·äï·ã∞·åà·â£·âΩ·àÅ withdraw ·âµ·âΩ·àã·àã·âΩ·àÅ ‚úÖ', 'https://s.hifamiapp.com/1/cfUpkaAgC', 'https://youtu.be/exampleHifamiTutorial', 'https://images.unsplash.com/photo-1612287230202-1ff1d85d1bdf?w=500', '["Game ·â†·àò·å´·ãà·âµ ·ã≠·à∞·à´·àç","0.1$ Per Invite","3x Withdrawal Done"]', 1, 0.3, 0.1],
                ['Buzzer üì±', 'app', 'Video earning app', 'üí∞ USDT (Dollar) ·àò·àµ·à´·âµ ·âµ·âΩ·àã·àã·âΩ·àÅ', 'https://app.buzzerfan.com/referral-invite/rsa6b36e1076a44ffb8948fdcfb2818892', 'https://youtu.be/exampleBuzzerTutorial', 'https://images.unsplash.com/photo-1611162618071-b39a2ec055fb?w=500', '["Watch Video","Like ‚ù§Ô∏è Comment üí¨","1 Invite = 0.15$","100% Withdrawal Proof"]', 1, 5, 0.15]
            ];

            const stmt = db.prepare(`
                INSERT INTO jobs (title, type, description, amharic_desc, download_link, tutorial_link, image_url, features, payment_verified, min_withdraw, referral_bonus)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            `);

            for (const job of sampleJobs) {
                stmt.run(job);
            }
            stmt.free();

            console.log('‚úÖ Sample jobs inserted');
        }
    }

    // Save database to localStorage
    function saveDatabase() {
        if (!db) return;
        const data = db.export();
        const buffer = new Uint8Array(data);
        const base64 = btoa(String.fromCharCode.apply(null, buffer));
        localStorage.setItem(DB_NAME, base64);
        console.log('üíæ Database saved to storage');
    }

    // Get database stats
    function getDatabaseStats() {
        try {
            const tables = db.exec("SELECT name FROM sqlite_master WHERE type='table'");
            let totalRecords = 0;
            
            for (const table of tables.values) {
                const tableName = table[0];
                if (!['sqlite_sequence'].includes(tableName)) {
                    const count = db.exec(`SELECT COUNT(*) FROM ${tableName}`)[0]?.values[0][0] || 0;
                    totalRecords += count;
                }
            }

            return {
                tables: tables.values.length,
                records: totalRecords
            };
        } catch (error) {
            return { tables: 0, records: 0 };
        }
    }

    // ==================== USER AUTHENTICATION ====================
    const ADMIN_USERNAME = "hayre32";
    let currentUser = { 
        id: null,
        telegramId: '', 
        firstName: 'User', 
        username: '',
        phoneVerified: false,
        isAdmin: false,
        balance: 0,
        tasksCompleted: 0,
        referrals: 0,
        totalEarned: 0
    };

    // Initialize user from Telegram
    if (tg.initDataUnsafe?.user) {
        const tgUser = tg.initDataUnsafe.user;
        currentUser = {
            ...currentUser,
            telegramId: tgUser.id.toString(),
            firstName: tgUser.first_name || 'User',
            lastName: tgUser.last_name || '',
            username: tgUser.username || ''
        };
    }

    // Sync user with SQLite
    async function syncUserWithDatabase() {
        if (!db) return;

        try {
            // Check if user exists
            const result = db.exec(`
                SELECT * FROM users WHERE telegram_id = '${currentUser.telegramId}'
            `);

            if (result.length > 0) {
                // Update existing user
                const userData = result[0].values[0];
                const columns = result[0].columns;
                
                currentUser = {
                    id: userData[columns.indexOf('id')],
                    telegramId: userData[columns.indexOf('telegram_id')],
                    username: userData[columns.indexOf('username')],
                    firstName: userData[columns.indexOf('first_name')],
                    lastName: userData[columns.indexOf('last_name')],
                    phoneVerified: userData[columns.indexOf('phone_verified')] === 1,
                    isAdmin: userData[columns.indexOf('is_admin')] === 1,
                    balance: userData[columns.indexOf('balance')],
                    tasksCompleted: userData[columns.indexOf('tasks_completed')],
                    referrals: userData[columns.indexOf('referrals')],
                    totalEarned: userData[columns.indexOf('total_earned')]
                };

                // Update last active
                db.run(`
                    UPDATE users 
                    SET last_active = CURRENT_TIMESTAMP,
                        username = '${currentUser.username}',
                        first_name = '${currentUser.firstName}'
                    WHERE telegram_id = '${currentUser.telegramId}'
                `);
                
            } else {
                // Create new user
                const isAdmin = currentUser.username?.toLowerCase() === ADMIN_USERNAME.toLowerCase() ? 1 : 0;
                
                db.run(`
                    INSERT INTO users (telegram_id, username, first_name, last_name, is_admin)
                    VALUES ('${currentUser.telegramId}', '${currentUser.username}', '${currentUser.firstName}', '${currentUser.lastName || ''}', ${isAdmin})
                `);

                // Get the new user's ID
                const newUser = db.exec(`
                    SELECT * FROM users WHERE telegram_id = '${currentUser.telegramId}'
                `);
                
                if (newUser.length > 0) {
                    const userData = newUser[0].values[0];
                    const columns = newUser[0].columns;
                    currentUser.id = userData[columns.indexOf('id')];
                }

                // Add welcome activity
                db.run(`
                    INSERT INTO activities (user_id, activity_type, description, amount)
                    VALUES (${currentUser.id}, 'task_completed', 'Welcome bonus', 5)
                `);
            }

            // Set admin status
            currentUser.isAdmin = currentUser.username?.toLowerCase() === ADMIN_USERNAME.toLowerCase();
            
            saveDatabase();
            updateUserUI();
            
        } catch (error) {
            console.error('Error syncing user:', error);
            updateUserUI();
        }
    }

    // Update UI with user info
    function updateUserUI() {
        const displayName = currentUser.firstName || 'User';
        document.getElementById('user-status').innerText = currentUser.isAdmin ? 'üëë Admin' : `@${currentUser.username || displayName}`;
        document.getElementById('user-avatar').src = `https://ui-avatars.com/api/?name=${displayName}&background=0088cc&color=fff&bold=true`;
        document.getElementById('welcomeName').innerText = currentUser.isAdmin ? `Welcome Admin ${displayName}!` : `Welcome ${displayName}!`;
    }

    // ==================== JOBS MANAGEMENT ====================
    function loadJobs() {
        const container = document.getElementById('job-container');
        
        if (!db) {
            container.innerHTML = '<div class="alert alert-warning">Database not initialized</div>';
            return;
        }

        try {
            const result = db.exec(`
                SELECT * FROM jobs WHERE is_active = 1 ORDER BY created_at DESC
            `);

            if (result.length === 0) {
                container.innerHTML = '<div class="text-center py-5"><i class="bi bi-inbox fs-1 text-muted"></i><p class="mt-2 text-muted">No jobs available yet</p></div>';
                document.getElementById('app-count').textContent = '(0)';
                document.getElementById('bot-count').textContent = '(0)';
                document.getElementById('web-count').textContent = '(0)';
                return;
            }

            const columns = result[0].columns;
            const jobs = result[0].values.map(row => {
                const job = {};
                columns.forEach((col, index) => {
                    job[col] = row[index];
                });
                // Parse features JSON
                if (job.features) {
                    try {
                        job.features = JSON.parse(job.features);
                    } catch (e) {
                        job.features = [];
                    }
                }
                return job;
            });

            // Update counts
            const appCount = jobs.filter(j => j.type === 'app').length;
            const botCount = jobs.filter(j => j.type === 'bot').length;
            const webCount = jobs.filter(j => j.type === 'web').length;
            
            document.getElementById('app-count').textContent = `(${appCount})`;
            document.getElementById('bot-count').textContent = `(${botCount})`;
            document.getElementById('web-count').textContent = `(${webCount})`;

            container.innerHTML = jobs.map(job => createJobCard(job)).join('');

        } catch (error) {
            console.error('Error loading jobs:', error);
            container.innerHTML = '<div class="alert alert-danger">Failed to load jobs</div>';
        }
    }

    function createJobCard(job) {
        const features = job.features || [];
        const featuresHtml = features.map(f => 
            `<li><i class="bi bi-check-circle-fill"></i> <span class="feature-emoji">‚úÖ</span> ${f}</li>`
        ).join('');

        return `
            <div class="card-job shadow-sm" data-type="${job.type}">
                <img src="${job.image_url || 'https://images.unsplash.com/photo-1611162618071-b39a2ec055fb?w=500'}" class="card-img" alt="${job.title}">
                <div class="job-content">
                    <div class="job-title">${job.title} <span class="app-badge">${job.type}</span></div>
                    <div class="amharic-description">
                        <div class="amharic-text">${job.amharic_desc || job.description}</div>
                        <ul class="feature-list">
                            ${featuresHtml}
                            ${job.payment_verified ? '<li><i class="bi bi-check-circle-fill"></i> <span class="feature-emoji">‚úÖ</span> 100% Payment Verified</li>' : ''}
                            ${job.min_withdraw ? `<li><i class="bi bi-check-circle-fill"></i> <span class="feature-emoji">üí∏</span> Minimum Withdraw $${job.min_withdraw}</li>` : ''}
                            ${job.referral_bonus ? `<li><i class="bi bi-check-circle-fill"></i> <span class="feature-emoji">ü§ë</span> $${job.referral_bonus} Per Referral</li>` : ''}
                        </ul>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-app details" onclick="openLink('${job.download_link}')"><i class="bi bi-info-circle"></i> Details</button>
                        <button class="btn-app download" onclick="openLink('${job.download_link}')"><i class="bi bi-download"></i> Download</button>
                        <button class="btn-app tutorial" onclick="openLink('${job.tutorial_link || '#'}')"><i class="bi bi-play-circle"></i> Tutorial</button>
                    </div>
                </div>
            </div>
        `;
    }

    // ==================== ADD NEW JOB (ADMIN) ====================
    function addNewJob() {
        if (!currentUser.isAdmin) {
            tg.showPopup({ message: 'Admin access required' });
            return;
        }

        const name = document.getElementById('jobName')?.value;
        const type = document.getElementById('jobType')?.value;
        const desc = document.getElementById('jobDesc')?.value;
        const download = document.getElementById('jobDownload')?.value;
        const tutorial = document.getElementById('jobTutorial')?.value;
        const img = document.getElementById('jobImg')?.value;

        if (!name || !desc || !download) {
            tg.showPopup({ message: 'Please fill required fields (name, description, download)' });
            return;
        }

        try {
            const features = JSON.stringify([]);
            
            db.run(`
                INSERT INTO jobs (title, type, description, amharic_desc, download_link, tutorial_link, image_url, features, payment_verified, min_withdraw, referral_bonus, created_by)
                VALUES ('${name}', '${type}', '${desc}', '${desc}', '${download}', '${tutorial}', '${img}', '${features}', 1, 10, 1, ${currentUser.id || 0})
            `);

            saveDatabase();
            tg.showPopup({ message: '‚úÖ Job added successfully!' });
            
            // Clear form
            document.getElementById('jobName').value = '';
            document.getElementById('jobDesc').value = '';
            document.getElementById('jobDownload').value = '';
            document.getElementById('jobTutorial').value = '';
            document.getElementById('jobImg').value = '';

            // Reload jobs if on jobs section
            if (!document.getElementById('sec-jobs').classList.contains('d-none')) {
                loadJobs();
            }

        } catch (error) {
            console.error('Error adding job:', error);
            tg.showPopup({ message: '‚ùå Failed to add job' });
        }
    }

    // ==================== PROFILE RENDER ====================
    function renderProfile() {
        const container = document.getElementById('profileContainer');
        if (!container || !db) return;

        try {
            // Fetch user activities
            let activities = [];
            if (currentUser.id) {
                const result = db.exec(`
                    SELECT * FROM activities 
                    WHERE user_id = ${currentUser.id} 
                    ORDER BY created_at DESC 
                    LIMIT 10
                `);
                
                if (result.length > 0) {
                    const columns = result[0].columns;
                    activities = result[0].values.map(row => {
                        const activity = {};
                        columns.forEach((col, index) => {
                            activity[col] = row[index];
                        });
                        return activity;
                    });
                }
            }

            const recentActivity = activities.map(a => 
                `${a.activity_type === 'task_completed' ? '‚úÖ' : 
                  a.activity_type === 'referral_bonus' ? 'üë•' : 
                  a.activity_type === 'withdrawal' ? 'üí∏' : '‚≠ê'} ${a.description} ${a.amount ? (a.amount > 0 ? '+$' + a.amount : '-$' + Math.abs(a.amount)) : ''}`
            ) || [
                '‚úÖ Completed Buzzer task +$2.50',
                'üì• Downloaded Gemgala',
                'üë• Referral bonus +$1.00',
                '‚≠ê Earned 50 Stars'
            ];

            const badges = [
                { icon: 'üî•', label: '7 Day Streak' },
                { icon: 'üéØ', label: 'First Withdrawal' },
                { icon: 'üë•', label: `${currentUser.referrals || 0} Referrals` },
                { icon: '‚úÖ', label: 'Verified User' }
            ];

            const hasPremium = (parseInt(currentUser.telegramId) % 3 === 0); // Simulated

            let html = `
                <div class="profile-header-card fade-in">
                    <div class="d-flex align-items-center gap-3 flex-wrap">
                        <img src="https://ui-avatars.com/api/?name=${currentUser.firstName}&size=80&length=2&background=0088cc&color=fff&bold=true" class="rounded-circle border border-3 border-white shadow" width="70" height="70">
                        <div>
                            <h4 class="fw-bold mb-1" style="color: #1c1c1e !important;">${currentUser.firstName} ${currentUser.isAdmin ? '<span class="badge bg-danger">ADMIN</span>' : ''}</h4>
                            <p class="text-muted mb-1" style="color: #666 !important;">@${currentUser.username || 'no_username'}</p>
                            <div class="d-flex gap-2 flex-wrap">
                                <span class="verified-badge" style="color: #00a65a !important;">
                                    <i class="bi bi-telephone-fill"></i> ${currentUser.phoneVerified ? 'üì± Verified by Phone' : '‚ùå Not Verified'}
                                </span>
                                ${hasPremium ? '<span class="premium-user-badge" style="color: #8B5CF6 !important;"><i class="bi bi-gem"></i> Telegram Premium</span>' : ''}
                                <span class="badge bg-secondary" style="color: white !important;"><i class="bi bi-person-badge"></i> ID: ${currentUser.telegramId}</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-grid">
                        <div class="stat-item"><span class="stat-value" style="color: #0088cc !important;">${currentUser.tasksCompleted || 47}</span> <span class="stat-label" style="color: #666 !important;">Tasks</span></div>
                        <div class="stat-item"><span class="stat-value" style="color: #0088cc !important;">$${currentUser.totalEarned || 127.50}</span> <span class="stat-label" style="color: #666 !important;">Earned</span></div>
                        <div class="stat-item"><span class="stat-value" style="color: #0088cc !important;">${currentUser.referrals || 12}</span> <span class="stat-label" style="color: #666 !important;">Referrals</span></div>
                    </div>

                    <div class="badge-collection">
                        ${badges.map(b => `<span class="achievement-badge" style="color: #0066a1 !important;"><i class="bi bi-patch-check-fill text-primary"></i> ${b.icon} ${b.label}</span>`).join('')}
                    </div>

                    <hr class="my-3">
                    <h6 class="fw-bold" style="color: #1c1c1e !important;"><i class="bi bi-activity"></i> Recent activity</h6>
                    <div class="mt-2">
                        ${recentActivity.map(a => `<div class="small py-1 border-bottom" style="color: #444 !important;">${a}</div>`).join('')}
                    </div>

                    ${!currentUser.phoneVerified ? `
                        <div class="mt-3">
                            <button class="btn btn-outline-success w-100 rounded-pill" onclick="verifyPhone()">
                                <i class="bi bi-telephone-plus"></i> Verify Phone Number
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;

            // Admin Panel
            if (currentUser.isAdmin) {
                // Get total users
                const userCount = db.exec("SELECT COUNT(*) as count FROM users")[0]?.values[0][0] || 0;
                const activeToday = db.exec(`
                    SELECT COUNT(*) as count FROM users 
                    WHERE date(last_active) = date('now')
                `)[0]?.values[0][0] || 0;

                html += `
                    <div class="admin-panel fade-in mt-3">
                        <div class="d-flex align-items-center gap-2 mb-3">
                            <i class="bi bi-shield-lock-fill fs-3 text-warning"></i>
                            <h5 class="fw-bold mb-0 text-white">Admin Console</h5>
                        </div>

                        <div class="admin-tool">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-white"><i class="bi bi-people-fill me-2"></i>Total users</span>
                                <span class="badge bg-light text-dark">${userCount}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <span class="text-white"><i class="bi bi-person-check-fill me-2"></i>Active today</span>
                                <span class="badge bg-success">${activeToday}</span>
                            </div>
                        </div>

                        <div class="admin-tool">
                            <span class="text-white"><i class="bi bi-plus-circle me-2"></i>Add New Job</span>
                            <div class="add-job-form">
                                <label class="text-white-50">App Name</label>
                                <input type="text" id="jobName" placeholder="e.g., Gemgala">
                                
                                <label class="text-white-50">Type</label>
                                <select id="jobType">
                                    <option value="app">üì≤ App</option>
                                    <option value="bot">ü§ñ Bot</option>
                                    <option value="web">üåê Web</option>
                                </select>

                                <label class="text-white-50">Description</label>
                                <textarea id="jobDesc" placeholder="Short description..." rows="2"></textarea>

                                <label class="text-white-50">Download Link</label>
                                <input type="url" id="jobDownload" placeholder="https://...">

                                <label class="text-white-50">Tutorial Link</label>
                                <input type="url" id="jobTutorial" placeholder="https://...">

                                <label class="text-white-50">Image URL</label>
                                <input type="url" id="jobImg" placeholder="https://...">

                                <button class="btn btn-warning w-100 mt-2" onclick="addNewJob()">
                                    <i class="bi bi-upload"></i> Publish Job
                                </button>
                            </div>
                        </div>

                        <div class="mt-3 small text-warning text-center">
                            <i class="bi bi-exclamation-triangle-fill"></i> Admin privileges active
                        </div>
                    </div>
                `;
            }

            // User tools
            html += `
                <div class="card mt-3 border-0 shadow-sm rounded-4 p-3">
                    <h6 class="fw-bold" style="color: #1c1c1e !important;"><i class="bi bi-tools"></i> User tools</h6>
                    <div class="row g-2 mt-2">
                        <div class="col-6"><button class="btn btn-outline-primary w-100 btn-sm" onclick="tg.showPopup({message:'Support chat demo'})"><i class="bi bi-chat-dots"></i> Support</button></div>
                        <div class="col-6"><button class="btn btn-outline-secondary w-100 btn-sm" onclick="shareReferral()"><i class="bi bi-share"></i> Refer</button></div>
                        <div class="col-6"><button class="btn btn-outline-success w-100 btn-sm" onclick="showHistory()"><i class="bi bi-wallet2"></i> History</button></div>
                        <div class="col-6"><button class="btn btn-outline-danger w-100 btn-sm" onclick="tg.showPopup({message:'Settings demo'})"><i class="bi bi-gear"></i> Settings</button></div>
                    </div>
                </div>
            `;

            container.innerHTML = html;

        } catch (error) {
            console.error('Error rendering profile:', error);
            container.innerHTML = '<div class="alert alert-danger">Failed to load profile</div>';
        }
    }

    // ==================== PHONE VERIFICATION ====================
    function verifyPhone() {
        tg.showPopup({
            title: 'Phone Verification',
            message: 'Enter your phone number:',
            buttons: [
                { id: 'cancel', type: 'cancel' },
                { id: 'verify', type: 'default', text: 'Verify' }
            ]
        }, (buttonId) => {
            if (buttonId === 'verify' && currentUser.id) {
                db.run(`
                    UPDATE users SET phone_verified = 1 WHERE id = ${currentUser.id}
                `);
                
                db.run(`
                    INSERT INTO activities (user_id, activity_type, description, amount)
                    VALUES (${currentUser.id}, 'task_completed', 'Phone verified', 2)
                `);
                
                saveDatabase();
                currentUser.phoneVerified = true;
                renderProfile();
                tg.showPopup({ message: '‚úÖ Phone verified successfully!' });
            }
        });
    }

    // ==================== REFERRAL SYSTEM ====================
    function shareReferral() {
        const referralLink = `https://t.me/YourBot?start=${currentUser.telegramId}`;
        tg.openTelegramLink(referralLink);
    }

    // ==================== PURCHASE FUNCTIONS ====================
    function buyStars() {
        tg.showPopup({
            title: 'Buy Stars',
            message: 'Choose amount:',
            buttons: [
                { id: '100', type: 'default', text: '100 Stars - $1.99' },
                { id: '500', type: 'default', text: '500 Stars - $8.99' },
                { id: '1000', type: 'default', text: '1000 Stars - $15.99' },
                { id: 'cancel', type: 'cancel' }
            ]
        }, (buttonId) => {
            if (buttonId && buttonId !== 'cancel' && currentUser.id) {
                const amount = parseInt(buttonId);
                const price = amount === 100 ? 1.99 : amount === 500 ? 8.99 : 15.99;

                db.run(`
                    INSERT INTO star_purchases (user_id, amount, price, status)
                    VALUES (${currentUser.id}, ${amount}, ${price}, 'completed')
                `);

                db.run(`
                    UPDATE users SET balance = balance + ${amount * 0.1} WHERE id = ${currentUser.id}
                `);

                db.run(`
                    INSERT INTO activities (user_id, activity_type, description, amount)
                    VALUES (${currentUser.id}, 'stars_purchased', 'Purchased ${amount} stars', ${price})
                `);

                saveDatabase();
                tg.showPopup({ message: `‚úÖ Successfully purchased ${buttonId} stars!` });
            }
        });
    }

    function buyPremium(type) {
        tg.showPopup({
            title: 'Coming Soon',
            message: 'Premium subscription will be available soon!',
            buttons: [{ id: 'ok', type: 'ok' }]
        });
    }

    function showHistory() {
        if (!currentUser.id) {
            tg.showPopup({ message: 'No history available' });
            return;
        }

        const result = db.exec(`
            SELECT * FROM activities 
            WHERE user_id = ${currentUser.id} 
            ORDER BY created_at DESC 
            LIMIT 20
        `);

        if (result.length > 0) {
            const columns = result[0].columns;
            const activities = result[0].values.map(row => {
                const activity = {};
                columns.forEach((col, index) => {
                    activity[col] = row[index];
                });
                return activity;
            });

            const history = activities.map(a => 
                `${new Date(a.created_at).toLocaleDateString()}: ${a.description} ${a.amount ? (a.amount > 0 ? '(+$' + a.amount + ')' : '(-$' + Math.abs(a.amount) + ')') : ''}`
            ).join('\n');
            
            tg.showPopup({ message: history || 'No history yet' });
        } else {
            tg.showPopup({ message: 'No history yet' });
        }
    }

    // ==================== FILTER & SEARCH ====================
    function filterType(type, element) {
        document.querySelectorAll('.card-job').forEach(card => {
            card.style.display = (type === 'all' || card.dataset.type === type) ? 'block' : 'none';
        });
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        element.classList.add('active');
        tg.HapticFeedback.selectionChanged();
    }

    // Search functionality
    const searchInput = document.getElementById('jobSearch');
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('.card-job').forEach(card => {
                const title = card.querySelector('.job-title')?.innerText.toLowerCase() || '';
                card.style.display = title.includes(term) ? 'block' : 'none';
            });
        });
    }

    // ==================== NAVIGATION ====================
    function nav(secId, btn) {
        document.querySelectorAll('section').forEach(s => s.classList.add('d-none'));
        const target = document.getElementById(secId);
        if (target) target.classList.remove('d-none');

        if (secId === 'sec-profile') {
            renderProfile();
        } else if (secId === 'sec-jobs') {
            loadJobs();
        }

        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        tg.HapticFeedback.impactOccurred('light');
    }

    function navigateTo(secId) {
        const btn = Array.from(document.querySelectorAll('.nav-btn')).find(b => b.getAttribute('onclick')?.includes(secId));
        if (btn) nav(secId, btn);
    }

    function openLink(url) {
        tg.openLink(url);
    }

    // ==================== INITIALIZATION ====================
    // Initialize database and sync user
    initDatabase().then(() => {
        syncUserWithDatabase();
    });

    // Expose functions globally
    window.nav = nav;
    window.navigateTo = navigateTo;
    window.filterType = filterType;
    window.openLink = openLink;
    window.addNewJob = addNewJob;
    window.verifyPhone = verifyPhone;
    window.shareReferral = shareReferral;
    window.buyStars = buyStars;
    window.buyPremium = buyPremium;
    window.showHistory = showHistory;
</script>
</body>
</html>
